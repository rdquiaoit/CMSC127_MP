<!DOCTYPE html>
<html>
<head>
	<title>COVID-19 Dashboard</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;400&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<!--//href="../css/style.css" -->
</head>
<body>

	<h1 id="header">COVID-19 Dashboard</h1>
	<hr>
	<div id="graph_A">
		<h3 align="left">Dataset A </h3>
		<div id="grid-container-a">
			<div id="grid-item-1">
				<canvas id="line-chart" width="150" height="40"></canvas><br>
			</div>
			<div id="grid-item-2">
				<canvas id="death-chart" width="200" height="200"></canvas><br>
			</div>
			<div id="grid-item-3">
				<canvas id="recover-chart" width="200" height="200"></canvas><br>
			</div>
			<div id="grid-item-4">
				<canvas id="confirm-chart" width="200" height="200"></canvas><br>
			</div>
		</div>
	</div>
	
	
	

	{% block heading %} {% endblock %}
	
	{% block body %}
	{% endblock %}
	


<!-- JAVASCRIPT -->
<script>

	createChart();

	async function createChart(){
		const data = await getData();

		// Line chart
		// shows a line graph of deaths, recoveries, and confirmed cases in the Philippines
		new Chart(document.getElementById("line-chart"), {
	    	type: 'line',
	    	data: {
		      	labels: data.date,
		      	datasets: [{ 
		        	data: data.confirmed_ph,
		        	label: "confirmed cases",
		        	borderColor: "#fd7d00",
		        	fill: false
		        }, { 
		        	data: data.recovered_ph,
			        label: "recoveries",
			        borderColor: "#013183",
			    	fill: false
		        }, { 
		        	data: data.died_ph,
		        	label: "deaths",
		        	borderColor: "#e7b901",
		        	fill: false
		        }]
		    },
		    options: {
			    title: {
			        display: true,
			        text: 'Number of deaths, recoveries, and confirmed cases in the Philippines',
			        fontSize: 20
			    }		    	
		    }
		 });


		// Bar charts
		// shows a vertical bar graph of deaths in five(5) countries
		new Chart(document.getElementById("death-chart"), {
		    type: 'bar',
		    data: {
		        labels: data.countries,
		        datasets: 
		        [{
		            label: "Total cases",
		            backgroundColor: "#e7b901",
		            data: data.countries_dth,
		        }]
		    },
		    options: {
		        legend: { display: false },
		        title: {
			        display: true,
			        text: 'Total Number of Deaths in 5 Countries'
			    }
		    }
		});

		// shows a vertical bar graph of recoveries in five(5) countries
		new Chart(document.getElementById("recover-chart"), {
		    type: 'bar',
		    data: {
		        labels: data.countries,
		        datasets: 
		        [{
		            label: "Total cases",
		            backgroundColor: "#013183",
		            data: data.countries_rec,
		        }]
		    },
		    options: {
		        legend: { display: false },
		        title: {
			        display: true,
			        text: 'Total Number of Recoveries in 5 Countries'
			    }
		    }
		});

		// shows a vertical bar graph of confirmed cases in five(5) countries
		new Chart(document.getElementById("confirm-chart"), {
		    type: 'bar',
		    data: {
		        labels: data.countries,
		        datasets: 
		        [{
		            label: "Total cases",
		            backgroundColor: "#fd7d00",
		            data: data.countries_con,
		        }]
		    },
		    options: {
		        legend: { display: false },
		        title: {
			        display: true,
			        text: 'Total Number of Confirmed Cases in 5 Countries'
			    }
		    }
		});

	}

	// gets data from json and returns lists
	async function getData(){
		const date = [];
		const confirmed_ph = [];
		const recovered_ph = [];
		const died_ph = [];

		const countries_con = [];
		const countries_rec = [];
		const countries_dth = [];
		const countries = ["China", "Philippines", "Russia", "Afghanistan", "Spain"];

		const api_url = 'https://pomber.github.io/covid19/timeseries.json';
		const response = await fetch (api_url);
		const data = await response.json();

		// data of philippines
		const ph_data = data["Philippines"];
		for(i=0; i<ph_data.length; i++){
		  if (ph_data[i].confirmed > 99){
		    date.push(ph_data[i].date);
		    confirmed_ph.push(ph_data[i].confirmed);
		    recovered_ph.push(ph_data[i].recovered);
		    died_ph.push(ph_data[i].deaths);
		  }
		}

		//data of 5 countries
		for(i=0; i<countries.length; i++){
		  const country = data[countries[i]];
		  countries_con.push(country[country.length-1].confirmed);
		  countries_rec.push(country[country.length-1].recovered);
		  countries_dth.push(country[country.length-1].deaths);
		}

		return {date, confirmed_ph, recovered_ph, died_ph, countries, countries_con, countries_rec, countries_dth };
	}

</script>

</body>
</html>
